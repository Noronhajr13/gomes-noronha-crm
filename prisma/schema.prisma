generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String
  password   String
  role       Role     @default(CORRETOR)
  phone      String?
  avatar     String?
  creci      String?
  active     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  properties Property[]
  leads      Lead[]
  tasks      Task[]
  activities Activity[]
  @@map("users")
}

enum Role {
  ADMIN
  CORRETOR
  DESPACHANTE
  ASSISTENTE
}

model Property {
  id              String          @id @default(cuid())
  code            String          @unique
  title           String
  description     String?         @db.Text
  type            PropertyType
  transactionType TransactionType
  status          PropertyStatus  @default(DISPONIVEL)
  price           Float
  condominiumFee  Float?
  iptu            Float?
  area            Float
  bedrooms        Int             @default(0)
  bathrooms       Int             @default(0)
  suites          Int             @default(0)
  parking         Int             @default(0)
  yearBuilt       Int?
  address         String
  addressNumber   String?
  complement      String?
  neighborhood    String
  city            String
  state           String
  zipCode         String?
  latitude        Float?
  longitude       Float?
  images          String[]
  videos          String[]
  virtualTour     String?
  amenities       String[]
  featured        Boolean         @default(false)
  exclusive       Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  publishedAt     DateTime?
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  leads           Lead[]
  visits          Visit[]
  @@index([type])
  @@index([transactionType])
  @@index([city, neighborhood])
  @@index([price])
  @@map("properties")
}

enum PropertyType {
  CASA
  APARTAMENTO
  COBERTURA
  TERRENO
  SALA_COMERCIAL
  LOJA
  GALPAO
  SITIO
  FAZENDA
  KITNET
  FLAT
  SOBRADO
}

enum TransactionType {
  VENDA
  ALUGUEL
  VENDA_ALUGUEL
}

enum PropertyStatus {
  DISPONIVEL
  RESERVADO
  VENDIDO
  ALUGADO
  INATIVO
}

model Lead {
  id                       String           @id @default(cuid())
  name                     String
  email                    String
  phone                    String
  cpf                      String?
  source                   LeadSource
  status                   LeadStatus       @default(NOVO)
  message                  String?          @db.Text
  budget                   Float?
  interestType             TransactionType?
  preferredContact         String?
  preferredNeighborhoods   String[]
  score                    Int              @default(0)
  createdAt                DateTime         @default(now())
  updatedAt                DateTime         @updatedAt
  contactedAt              DateTime?
  convertedAt              DateTime?
  propertyId               String?
  property                 Property?        @relation(fields: [propertyId], references: [id])
  userId                   String?
  user                     User?            @relation(fields: [userId], references: [id])
  visits                   Visit[]
  activities               Activity[]
  @@index([source])
  @@index([createdAt])
  @@map("leads")
}

enum LeadSource {
  SITE
  WHATSAPP
  INDICACAO
  PORTAL_ZAP
  PORTAL_VIVAREAL
  PORTAL_OLX
  REDES_SOCIAIS
  TELEFONE
  VISITA_ESCRITORIO
  OUTRO
}

enum LeadStatus {
  NOVO
  CONTATO_REALIZADO
  QUALIFICADO
  VISITA_AGENDADA
  PROPOSTA_ENVIADA
  NEGOCIACAO
  FECHADO_GANHO
  FECHADO_PERDIDO
  INATIVO
}

model Visit {
  id          String      @id @default(cuid())
  scheduledAt DateTime
  completedAt DateTime?
  status      VisitStatus @default(AGENDADA)
  notes       String?     @db.Text
  feedback    String?     @db.Text
  rating      Int?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  propertyId  String
  property    Property    @relation(fields: [propertyId], references: [id])
  leadId      String
  lead        Lead        @relation(fields: [leadId], references: [id])
  @@index([scheduledAt])
  @@map("visits")
}

enum VisitStatus {
  AGENDADA
  CONFIRMADA
  REALIZADA
  CANCELADA
  REMARCADA
  NAO_COMPARECEU
}

model Task {
  id                String       @id @default(cuid())
  title             String
  description       String?      @db.Text
  dueDate           DateTime?
  priority          TaskPriority @default(MEDIA)
  status            TaskStatus   @default(PENDENTE)
  type              TaskType     @default(GERAL)
  relatedLeadId     String?
  relatedPropertyId String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  completedAt       DateTime?
  userId            String
  user              User         @relation(fields: [userId], references: [id])
  @@index([dueDate])
  @@map("tasks")
}

enum TaskPriority {
  BAIXA
  MEDIA
  ALTA
  URGENTE
}

enum TaskStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}

enum TaskType {
  GERAL
  LIGACAO
  VISITA
  DOCUMENTACAO
  CONTRATO
  FINANCEIRO
  FOLLOW_UP
}

model Activity {
  id          String       @id @default(cuid())
  type        ActivityType
  description String
  metadata    Json?
  createdAt   DateTime     @default(now())
  userId      String
  user        User         @relation(fields: [userId], references: [id])
  leadId      String?
  lead        Lead?        @relation(fields: [leadId], references: [id])
  @@index([createdAt])
  @@map("activities")
}

enum ActivityType {
  LEAD_CRIADO
  LEAD_ATUALIZADO
  LEAD_STATUS_ALTERADO
  CONTATO_REALIZADO
  VISITA_AGENDADA
  VISITA_REALIZADA
  PROPOSTA_ENVIADA
  NEGOCIACAO_INICIADA
  VENDA_REALIZADA
  IMOVEL_CADASTRADO
  IMOVEL_ATUALIZADO
  TAREFA_CRIADA
  TAREFA_CONCLUIDA
  COMENTARIO_ADICIONADO
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@map("settings")
}
